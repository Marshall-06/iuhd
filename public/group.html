<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Group Management</title>
<style>
  body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f6fa; }
  .container { max-width: 900px; margin: 50px auto; background: #fff; padding: 30px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
  h1 { text-align: center; color: #333; margin-bottom: 25px; }
  table { width: 100%; border-collapse: collapse; margin-top: 20px; }
  th, td { padding: 12px; border: 1px solid #ddd; text-align: left; }
  th { background-color: #007bff; color: white; }
  input, button { padding: 10px; margin-top: 5px; border-radius: 8px; border: 1px solid #ccc; font-size: 14px; }
  button { cursor: pointer; background: #007bff; color: white; border: none; transition: 0.3s; }
  button:hover { background: #0056b3; }
  .success { color: #2ecc71; font-weight: bold; margin-top: 10px; }
  .error { color: #e74c3c; font-weight: bold; margin-top: 10px; }
  .actions button { margin-right: 5px; }
</style>
</head>
<body>
<div class="container">
  <h1>Group Management</h1>

  <div>
    <h3>Create / Update Group</h3>
    <input type="text" id="groupName" placeholder="Group Name">
    <input type="hidden" id="groupId">
    <button id="saveGroupBtn">Save Group</button>
    <p id="message" class="success"></p>
    <p id="error" class="error"></p>
  </div>

  <h3>All Groups</h3>
  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Created At</th>
        <th>Updated At</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="groupTableBody">
      <tr><td colspan="5">Loading groups...</td></tr>
    </tbody>
  </table>
</div>

<script>
const API_URL = "http://localhost:5000/api/group"; // adjust for your server
// const token = localStorage.getItem("token"); // optional if you have auth

const groupTableBody = document.getElementById("groupTableBody");
const groupNameInput = document.getElementById("groupName");
const groupIdInput = document.getElementById("groupId");
const saveGroupBtn = document.getElementById("saveGroupBtn");
const messageEl = document.getElementById("message");
const errorEl = document.getElementById("error");

// --- Load Groups ---
async function loadGroups() {
  try {
    const res = await fetch(`${API_URL}/all`); // add headers if needed
    const data = await res.json();
    groupTableBody.innerHTML = "";
    const groups = data.groups || data; // in case your API returns {groups: [...]}
    if (groups.length === 0) {
      groupTableBody.innerHTML = '<tr><td colspan="5">No groups found</td></tr>';
      return;
    }
    groups.forEach(g => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${g.id}</td>
        <td>${g.name}</td>
        <td>${new Date(g.createdAt).toLocaleString()}</td>
        <td>${new Date(g.updatedAt).toLocaleString()}</td>
        <td class="actions">
          <button onclick="editGroup(${g.id}, '${g.name}')">Edit</button>
          <button onclick="deleteGroup(${g.id})">Delete</button>
        </td>
      `;
      groupTableBody.appendChild(row);
    });
  } catch (err) {
    groupTableBody.innerHTML = `<tr><td colspan="5">Failed to load groups</td></tr>`;
  }
}

// --- Create / Update Group ---
saveGroupBtn.addEventListener("click", async () => {
  const name = groupNameInput.value.trim();
  const id = groupIdInput.value;
  messageEl.textContent = "";
  errorEl.textContent = "";

  if (!name) { errorEl.textContent = "Group name is required"; return; }

  try {
    let res;
    if (id) {
      // Update
      res = await fetch(`${API_URL}/update/${id}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name })
      });
    } else {
      // Create
      res = await fetch(`${API_URL}/create`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name })
      });
    }
    const data = await res.json();
    if (res.ok) {
      messageEl.textContent = data.message || "Success";
      groupNameInput.value = "";
      groupIdInput.value = "";
      loadGroups();
    } else {
      errorEl.textContent = data.message || "Failed";
    }
  } catch (err) {
    errorEl.textContent = "Server error";
  }
});

// --- Edit Group ---
function editGroup(id, name) {
  groupIdInput.value = id;
  groupNameInput.value = name;
}

// --- Delete Group ---
async function deleteGroup(id) {
  if (!confirm("Are you sure you want to delete this group?")) return;
  try {
    const res = await fetch(`${API_URL}/delete/${id}`, {
      method: "DELETE"
    });
    const data = await res.json();
    if (res.ok) {
      messageEl.textContent = data.message || "Deleted successfully";
      loadGroups();
    } else {
      errorEl.textContent = data.message || "Failed to delete";
    }
  } catch (err) {
    errorEl.textContent = "Server error";
  }
}

// --- Initial Load ---
loadGroups();
</script>
</body>
</html>
